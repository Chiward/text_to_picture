
# “宣传图文转图片”自动化脚本开发计划 (cc-runner.md)

本文档详细说明了开发一个“宣传文本转图片”自动化脚本的完整行动计划。计划遵循用户提出的核心任务与技术要求，旨在通过一个以网页为核心、Playwright MCP驱动的工作流，实现高效、一致的图片生成。

---

### **阶段零：项目启动与需求分析 (准备阶段)**

**目标：** 彻底理解需求，分析样式细节，并搭建项目基础结构。

1.  **样式分析与参数化 (关键步骤)**
    *   **任务：** 仔细研究 `素材样式/输出图片/` 目录下的三张参考图片。
    *   **分析要点：**
        *   **画布尺寸：** 确认宽度为 828px，并推算高度。
        *   **背景：**
            *   第一张图：分析其从上到下的渐变色（起始颜色、终止颜色）。
            *   后续图：确认其纯色背景的色号。
        *   **头像：**
            *   仅存在于第一张图。
            *   记录其尺寸、圆形遮罩 (`border-radius: 50%`)、边框样式（如有）、以及距离顶部和左侧的精确位置。
        *   **文字排版：**
            *   **标题：** 字体、字号、颜色、加粗样式、行高、以及与头像和页面边缘的间距。
            *   **正文：** 字体、字号、颜色、行高、段落间距。
            *   **特殊样式：** 记录红色高亮字体的确切色号。
    *   **产出：** 一份包含所有精确CSS参数（如 `font-family`, `font-size`, `color`, `margin`, `padding`, `background-image` 等）的内部笔记。

2.  **项目文件结构搭建**
    *   **任务：** 创建项目的基本目录和文件。
    *   **文件清单：**
        ```
        /
        ├───素材/
        │   ├─── input.txt             # 输入的源文本
        │   └─── avatar.webp           # 输入的用户头像
        ├───dist/                     # 存放最终生成的图片和文件包
        ├───src/
        │   ├─── index.html           # 作为模板的网页文件
        │   ├─── style.css            # 网页样式文件
        │   └─── main.py              # 核心自动化脚本
        ├─── cc-runner.md             # (本文件) 执行文档
        ├─── manual.md                # 操作手册
        ├─── dev_log.md               # 研发日志
        └─── experience.md            # 心得文档
        ```

---

### **阶段一：网页模板开发 (核心枢纽)**

**目标：** 创建一个结构良好、样式精确的HTML和CSS模板，使其能通过外部输入动态生成所有页面样式。

1.  **HTML 结构设计 (`src/index.html`)**
    *   **任务：** 编写HTML骨架，用于容纳动态内容。
    *   **核心结构：**
        *   一个主容器 `div`，ID为 `canvas`，宽度设置为 828px。
        *   在 `canvas` 内部，为每个最终要生成的图片创建一个独立的页面容器 `div`，类名为 `page`。例如 `<div class="page" id="page-1">...</div>`。
        *   **页面1 (`page-1`) 的特殊结构：**
            *   包含一个 `img` 标签用于显示头像。
            *   包含 `h1` 标签用于标题。
            *   包含一个 `div` 用于正文内容。
            *   应用特殊的渐变背景样式。
        *   **后续页面 (`page-2`, `page-3`, ...)**
            *   结构与页面1类似，但不包含头像 `img` 标签。
            *   应用纯色背景样式。

2.  **CSS 样式实现 (`src/style.css`)**
    *   **任务：** 将阶段零分析出的所有视觉参数转化为精确的CSS代码。
    *   **关键样式类：**
        *   `.canvas`: 定义基础画布属性。
        *   `.page`: 定义通用页面样式（如内边距、基础字体）。
        *   `.page-1-background`: 定义第一页的渐变背景。
        *   `.page-n-background`: 定义后续页面的纯色背景。
        *   `.avatar`: 定义头像的尺寸、位置、圆形和边框。
        *   `.title`: 定义标题的字体、大小、颜色和边距。
        *   `.content`: 定义正文的字体、大小、颜色和行高。
        *   `.bold`: 定义加粗文本样式。
        *   `.red-text`: 定义红色高亮文本样式。
    *   **交互逻辑：** 默认只显示第一个 `.page` 容器，其他隐藏 (`display: none;`)。这将便于后续脚本逐个截图。

---

### **阶段二：自动化脚本开发 (功能实现)**

**目标：** 编写Python脚本，实现文本解析、动态内容填充和截图的全流程自动化。

1.  **环境配置与初始化**
    *   **任务：** 确保 Playwright 环境就绪。
    *   **步骤：**
        *   创建 `requirements.txt` 并添加 `playwright`。
        *   运行 `pip install -r requirements.txt` 和 `playwright install`。

2.  **文本解析逻辑 (`src/main.py`)**
    *   **任务：** 编写函数读取 `input.txt` 并根据规则将其解析为结构化数据。
    *   **解析规则：**
        *   读取整个文本文件。
        *   按两个连续换行符 `

` 分割文本，得到页面内容数组。
        *   对每个页面内容：
            *   第一行作为标题。
            *   其余部分作为正文。
            *   在正文中，将 `**文字**` 模式替换为 `<strong class="bold">文字</strong>`。
            *   将 `/文字/` 模式替换为 `<span class="red-text">文字</span>`。
    *   **产出：** 一个数据结构，例如页面对象的列表 `[{title: "...", content_html: "..."}, ...]`。

3.  **Playwright MCP 核心控制流 (`src/main.py`)**
    *   **任务：** 编排浏览器自动化操作。
    *   **流程：**
        1.  启动 Playwright。
        2.  打开本地的 `src/index.html` 文件。
        3.  **内容注入：**
            *   使用 `page.evaluate()` 或类似方法，将解析后的页面数据动态生成对应的 `.page` div 元素，并插入到 `#canvas` 容器中。
            *   确保头像路径正确指向 `素材/avatar.webp`。
        4.  **循环截图：**
            *   遍历所有页面数据。
            *   对于第 `i` 个页面：
                *   执行JavaScript，将 `#page-i` 的 `display` 设置为 `block`，同时确保其他页面为 `display: none`。
                *   定位到 `#page-i` 元素。
                *   调用 `element_handle.screenshot()` 对该元素进行截图，保存到 `dist/output_{i}.png`。
        5.  关闭浏览器。

---

### **阶段三：迭代优化与交付**

**目标：** 对比产出，微调样式，并完成所有文档的撰写。

1.  **视觉对比与CSS微调 (迭代循环)**
    *   **任务：** 实现“自动对比和迭代优化”的务实版本。
    *   **流程：**
        1.  运行一次 `main.py` 脚本，生成第一版图片。
        2.  **手动对比：** 将 `dist/output_*.png` 与 `素材样式/输出图片/` 中的参考图进行并排比较。
        3.  **识别差异：** 找出字体、间距、颜色等方面的细微差别。
        4.  **调整代码：** 修改 `src/style.css` 中的参数。
        5.  重新运行脚本，回到步骤1，直到生成图片与参考图片在视觉上高度一致。

2.  **最终交付物打包**
    *   **任务：** 完善脚本，使其能将所有产出物整理好。
    *   **脚本增强：** 在 `main.py` 的末尾添加逻辑，将 `dist/` 目录下的所有 `output_*.png` 图片打包成一个 `dist/final_package.zip` 文件。

3.  **文档撰写**
    *   **`manual.md`:** 详细说明环境配置（Python, pip, Playwright）、如何安装依赖、以及如何通过命令行运行脚本（例如 `python src/main.py --text_file "素材/input.txt" --avatar_file "素材/avatar.webp"`）。
    *   **`dev_log.md`:** 在开发过程中，随时记录关键决策、遇到的问题和解决方案。例如：“决定使用CSS `background-image: linear-gradient()` 实现背景”、“发现Playwright截图时需等待字体加载，添加 `page.wait_for_load_state('networkidle')`”。
    *   **`experience.md`:** 开发完成后，总结整个项目的经验、挑战和学习心得。

---
此计划将在获得你的批准后开始执行。
